
local models = {
	[602] = true,
	[429] = true,
	[500] = true,
	[470] = true,
	
	[492] = true,
	[405] = true,
	[507] = true,
	[561] = true,
	-- [554] = true,
	-- [596] = true,
	[541] = true,
	[602] = true,
	[580] = true,
	[526] = true,
	[409] = true,
	[411] = {
		components = {
			['door_lf_dummy']={

				['door_dside_f0']=true,
				['door_dside_f1']=true,
			},
			['door_rf_dummy']={

				['door_pside_f0']=true,
				['door_pside_f1']=true,
			},
		},
	},
	[413] = {
		components = {
			['door_lf_dummy']={

				['door_dside_f0']=true,
				['door_dside_f1']=true,
			},
			['door_rf_dummy']={

				['door_pside_f0']=true,
				['door_pside_f1']=true,
			},
		},
	},
	[426] = {
		components = {
			['door_lf_dummy']={

				['door_dside_f0']=true,
				['door_dside_f1']=true,
			},
			['door_rf_dummy']={

				['door_pside_f0']=true,
				['door_pside_f1']=true,
			},
			['door_lr_dummy']={

				['door_dside_r0']=true,
				['door_dside_r1']=true,
			},
			['door_rr_dummy']={

				['door_pside_r0']=true,
				['door_pside_r1']=true,
			},
		},
	},
	[479] = {
		components = {
			['door_lf_dummy']={

				['doorfender_lf0']=true,
				['doorfender_lf1']=true,
				['doorfender_lf2']=true,
				['doorfender_lf3']=true,
				['doorfender_lf4']=true,

				['mirror_lf0']=true,
				['mirror_lf1']=true,
				['mirror_lf2']=true,
				
				['door_lf']=true,
				['window_lf']=true,
			},
			['door_rf_dummy']={

				['doorfender_rf0']=true,
				['doorfender_rf1']=true,
				['doorfender_rf2']=true,
				['doorfender_rf3']=true,
				['doorfender_rf4']=true,

				['mirror_rf0']=true,
				['mirror_rf1']=true,
				['mirror_rf2']=true,

				['door_rf']=true,
				['window_rf']=true,
			},
			['door_lr_dummy']={
				['doorfender_lr0']=true,
				['doorfender_lr1']=true,
				['doorfender_lr2']=true,
				['doorfender_lr3']=true,
				['doorfender_lr4']=true,
				['door_lr']=true,
				['window_lr']=true,
			},
			['door_rr_dummy']={
				['doorfender_rr0']=true,
				['doorfender_rr1']=true,
				['doorfender_rr2']=true,
				['doorfender_rr3']=true,
				['doorfender_rr4']=true,
				['door_rr']=true,
				['window_rr']=true,
			},
		},
	},
	[602] = {
		components = {
			['door_lf_dummy']={

				['doorfender_lf0']=true,
				['doorfender_lf1']=true,
				['doorfender_lf2']=true,
			},
			['door_rf_dummy']={

				['doorfender_rf0']=true,
				['doorfender_rf1']=true,
				['doorfender_rf2']=true,
			},
		},
	},
	[400] = {
		components = {
			['door_lf_dummy']={

				['door_dside_f0']=true,
				['door_dside_f1']=true,

				['door_lf']=true,
				['window_lf']=true,
			},
			['door_rf_dummy']={

				['door_pside_f0']=true,
				['door_pside_f1']=true,

				['door_rf']=true,
				['window_rf']=true,
			},
			['door_lr_dummy']={
				['doorfender_lr0']=true,
				['doorfender_lr1']=true,
				['doorfender_lr2']=true,
				['doorfender_lr3']=true,
				['doorfender_lr4']=true,
				['door_lr']=true,
				['window_lr']=true,
			},
			['door_rr_dummy']={
				['doorfender_rr0']=true,
				['doorfender_rr1']=true,
				['doorfender_rr2']=true,
				['doorfender_rr3']=true,
				['doorfender_rr4']=true,
				['door_rr']=true,
				['window_rr']=true,
			},
		},
	},
	[547] = {
		components = {
			['door_lf_dummy']={

				['doorfender_lf0']=true,
				['doorfender_lf1']=true,
				['doorfender_lf2']=true,
				['doorfender_lf3']=true,
				['doorfender_lf4']=true,

				['mirror_lf0']=true,
				['mirror_lf1']=true,
				['mirror_lf2']=true,
				
				['door_lf']=true,
				['window_lf']=true,
			},
			['door_rf_dummy']={

				['doorfender_rf0']=true,
				['doorfender_rf1']=true,
				['doorfender_rf2']=true,
				['doorfender_rf3']=true,
				['doorfender_rf4']=true,

				['mirror_rf0']=true,
				['mirror_rf1']=true,
				['mirror_rf2']=true,

				['door_rf']=true,
				['window_rf']=true,
			},
			['door_lr_dummy']={
				['doorfender_lr0']=true,
				['doorfender_lr1']=true,
				['doorfender_lr2']=true,
				['doorfender_lr3']=true,
				['doorfender_lr4']=true,
				['door_lr']=true,
				['window_lr']=true,
			},
			['door_rr_dummy']={
				['doorfender_rr0']=true,
				['doorfender_rr1']=true,
				['doorfender_rr2']=true,
				['doorfender_rr3']=true,
				['doorfender_rr4']=true,
				['door_rr']=true,
				['window_rr']=true,
			},
		},
	},
	[555] = {
		components = {
			['door_lf_dummy']={

				['doorfender_lf0']=true,
				['doorfender_lf1']=true,
				['doorfender_lf2']=true,
				['doorfender_lf3']=true,
				['doorfender_lf4']=true,

				['mirror_lf0']=true,
				['mirror_lf1']=true,
				['mirror_lf2']=true,
				
				['door_lf']=true,
				['window_lf']=true,
			},
			['door_rf_dummy']={

				['doorfender_rf0']=true,
				['doorfender_rf1']=true,
				['doorfender_rf2']=true,
				['doorfender_rf3']=true,
				['doorfender_rf4']=true,

				['mirror_rf0']=true,
				['mirror_rf1']=true,
				['mirror_rf2']=true,

				['door_rf']=true,
				['window_rf']=true,
			},
			['door_lr_dummy']={
				['doorfender_lr0']=true,
				['doorfender_lr1']=true,
				['doorfender_lr2']=true,
				['doorfender_lr3']=true,
				['doorfender_lr4']=true,
				['door_lr']=true,
				['window_lr']=true,
			},
			['door_rr_dummy']={
				['doorfender_rr0']=true,
				['doorfender_rr1']=true,
				['doorfender_rr2']=true,
				['doorfender_rr3']=true,
				['doorfender_rr4']=true,
				['door_rr']=true,
				['window_rr']=true,
			},
		},
	},
	[507] = {
		components = {
			['door_lf_dummy']={

				['doorfender_lf0']=true,
				['doorfender_lf1']=true,
				['doorfender_lf2']=true,
				['doorfender_lf3']=true,
				['doorfender_lf4']=true,

				['mirror_lf0']=true,
				['mirror_lf1']=true,
				['mirror_lf2']=true,
				
				['door_lf']=true,
				['window_lf']=true,
			},
			['door_rf_dummy']={

				['doorfender_rf0']=true,
				['doorfender_rf1']=true,
				['doorfender_rf2']=true,
				['doorfender_rf3']=true,
				['doorfender_rf4']=true,

				['mirror_rf0']=true,
				['mirror_rf1']=true,
				['mirror_rf2']=true,

				['door_rf']=true,
				['window_rf']=true,
			},
			['door_lr_dummy']={
				['doorfender_lr0']=true,
				['doorfender_lr1']=true,
				['doorfender_lr2']=true,
				['doorfender_lr3']=true,
				['doorfender_lr4']=true,
				['door_lr']=true,
				['window_lr']=true,
			},
			['door_rr_dummy']={
				['doorfender_rr0']=true,
				['doorfender_rr1']=true,
				['doorfender_rr2']=true,
				['doorfender_rr3']=true,
				['doorfender_rr4']=true,
				['door_rr']=true,
				['window_rr']=true,
			},
		},
	},
	-- [598] = {
	-- 	components = {
	-- 		['trunk0'] = {
	-- 			['spoiler0']=true,
	-- 			['spoiler1']=true,
	-- 			['spoiler2']=true,
	-- 			['spoiler3']=true,
	-- 		},
	-- 	},
	-- },
	-- [470] = {
	-- 	components = {
	-- 		['door_lf']={
	-- 			['door_dside_f0']=true,
	-- 			['door_dside_f1']=true,
	-- 		},
	-- 		['door_rf']={
	-- 			['door_pside_f0']=true,
	-- 			['door_pside_f1']=true,
	-- 		},
	-- 	},
	-- },
	-- [418] = {
	-- 	components = {
	-- 		['trunk0']={
	-- 			['trunk_badge0']=true,
	-- 			['trunk_badge1']=true,
	-- 		},
	-- 	},
	-- },
	[500] = {
		components = {
			['door_lf_dummy']={
				['door_lf']=true,
				['window_lf']=true,
				['door_dside_f0']=true,
				['door_dside_f1']=true,
				['doorpart_dside_f0']=true,
				['doorpart_dside_f1']=true,
			},
			['door_rf_dummy']={
				['door_rf']=true,
				['window_rf']=true,
				['door_pside_f0']=true,
				['door_pside_f1']=true,
				['doorpart_pside_f0']=true,
				['doorpart_pside_f1']=true,
			},
		},
	},
	[429] = {
		components = {
			['door_lf_dummy']={
				['door_dside_f0']=true,
				['door_dside_f1']=true,
			},
			['door_rf_dummy']={
				['door_pside_f0']=true,
				['door_pside_f1']=true,
			},
		},
	},
	[604] = {
		components = {
			['wheel_rf_dummy']={
				['wheel_logo_rf']={ axis = { Y = true, Z = true, }, pos = { Z = true, X = true, } },
			},
			['wheel_lf_dummy']={
				['wheel_logo_lf']={ axis = { Y = true, Z = true, }, pos = { Z = true, X = true, } },
			},
			['wheel_rb_dummy']={
				['wheel_logo_rb']={ axis = { Y = true, Z = true, }, pos = { Z = true, X = true, } },
			},
			['wheel_lb_dummy']={
				['wheel_logo_lb']={ axis = { Y = true, Z = true, }, pos = { Z = true, X = true, } },
			},
		},
	},
	[566] = {
		components = {
			['wheel_rf_dummy']={
				['wheel_center_fr']={ axis = { Y = true, Z = true, }, pos = { Z = true, X = true, } },
			},
			['wheel_lf_dummy']={
				['wheel_center_fl']={ axis = { Y = true, Z = true, }, pos = { Z = true, X = true, } },
			},
			['wheel_rb_dummy']={
				['wheel_center_rr']={ axis = { Y = true, Z = true, }, pos = { Z = true, X = true, } },
			},
			['wheel_lb_dummy']={
				['wheel_center_rl']={ axis = { Y = true, Z = true, }, pos = { Z = true, X = true, } },
			},

			['door_lf_dummy']={
				['doorfender_lf0']=true,
				['doorfender_lf1']=true,
			},

			['door_rf_dummy']={
				['doorfender_rf0']=true,
				['doorfender_rf1']=true,
			},

			['door_lr_dummy']={
				['doorfender_lr0']={ invert = true },
				['doorfender_lr1']={ invert = true },
			},

			['door_rr_dummy']={
				['doorfender_rr0']={ invert = true },
				['doorfender_rr1']={ invert = true },
			},

		},
	},
	[436] = {
		components = {
			['wheel_rf_dummy']={
				['wheel_emblem_FR']={ axis = { Y = true, Z = true, }, pos = { Z = true, X = true, } },
			},
			['wheel_lf_dummy']={
				['wheel_emblem_FL']={ axis = { Y = true, Z = true, }, pos = { Z = true, X = true, } },
			},
			['wheel_rb_dummy']={
				['wheel_emblem_RR']={ axis = { Y = true, Z = true, }, pos = { Z = true, X = true, } },
			},
			['wheel_lb_dummy']={
				['wheel_emblem_RL']={ axis = { Y = true, Z = true, }, pos = { Z = true, X = true, } },
			},
		},
	},
}

local angle = 72

local angleOverrideFunctions = {
	
	door_lf_dummy = function(vehicle)
		return -getVehicleDoorOpenRatio(vehicle, 2)*angle
	end,
	
	door_rf_dummy = function(vehicle)
		return getVehicleDoorOpenRatio(vehicle, 3)*angle
	end,
	
	door_lr_dummy = function(vehicle)
		return -getVehicleDoorOpenRatio(vehicle, 4)*angle
	end,
	
	door_rr_dummy = function(vehicle)
		return getVehicleDoorOpenRatio(vehicle, 5)*angle
	end,

}

local doors = {
	components = {
		['door_lf_dummy']={
			['door_dside_f0']=true,
			['door_dside_f1']=true,
			['door_dside_f2']=true,
			['door_dside_f3']=true,
			['door_dside_f4']=true,

			['doorfender_lf0']=true,
			['doorfender_lf1']=true,
			['doorfender_lf2']=true,
			['doorfender_lf3']=true,
			['doorfender_lf4']=true,

			['doorpart_dside_f0']=true,

			['fl_glass_r']=true,
			['door_lf']=true,
			['door_lf0']=true,
			['door_lf1']=true,
			['window_lf']=true,
		},
		['door_rf_dummy']={
			['door_pside_f0']=true,
			['door_pside_f1']=true,
			['door_pside_f2']=true,
			['door_pside_f3']=true,
			['door_pside_f4']=true,

			['doorpart_pside_f0']=true,

			['doorfender_rf0']=true,
			['doorfender_rf1']=true,
			['doorfender_rf2']=true,
			['doorfender_rf3']=true,
			['doorfender_rf4']=true,

			['fr_glass_r']=true,
			['door_rf']=true,
			['door_rf0']=true,
			['door_rf1']=true,
			['window_rf']=true,
		},
		['door_lr_dummy']={
			['doorfender_lr0']=true,
			['doorfender_lr1']=true,
			['doorfender_lr2']=true,
			['doorfender_lr3']=true,
			['doorfender_lr4']=true,
			['rl_glass_r']=true,
			['door_lr']=true,
			['door_lr0']=true,
			['door_lr1']=true,
		},
		['door_rr_dummy']={
			['doorfender_rr0']=true,
			['doorfender_rr1']=true,
			['doorfender_rr2']=true,
			['doorfender_rr3']=true,
			['doorfender_rr4']=true,
			['rr_glass_r']=true,
			['door_rr']=true,
			['door_rr0']=true,
			['door_rr1']=true,
		},
		['bonnet0']={
			['bonnet_attach0']=true,
			['bonnet_attach1']=true,
			['bonnet_attach2']=true,
		},
		['boot_dummy']={
			['boot_badge_1']=true,
			['boot_badge_2']=true,
			['spoiler_1']=true,
			['spoiler_2']=true,
		},
	},
}

addEventHandler('onClientPreRender', root, function()
	-- if localPlayer.dimension == 0 then return end
	for vehicle in pairs( streamedVehicles ) do

		if isElement(vehicle) and isElementOnScreen(vehicle) and getVehicleType(vehicle) ~= 'Bike' then
			local model = getElementModel(vehicle)
			local config = models[model]
			if config then

				local components = getVehicleComponents(vehicle)

				for name, data in pairs(config.components) do
					if components[name] ~= nil then

						local visible = getVehicleComponentVisible(vehicle, name)

						local rx,ry,rz
						if angleOverrideFunctions[name] then
							rx,ry,rz = 0, 0, (angleOverrideFunctions[name])(vehicle)
						else
							rx,ry,rz = getVehicleComponentRotation(vehicle, name)
						end

						local px,py,pz = getVehicleComponentPosition(vehicle, name)



						for name, _c_data in pairs( data ) do

							if components[name] then

								local c_data = ( type(_c_data) == 'table' ) and _c_data or {}

								local axis = c_data.axis or config.axis
								local pos = c_data.pos or config.pos

								if axis then
									if not axis.X then rx = 0 end
									if not axis.Y then ry = 0 end
									if not axis.Z then rz = 0 end
								end

								setVehicleComponentRotation(vehicle, name, rx,ry,rz)

								if c_data.invert then
									setVehicleComponentRotation(vehicle, name, rx,ry+180,-rz+180)
								end

								if pos then
									local dpx,dpy,dpz = getVehicleComponentPosition(vehicle, name)
									if pos.X then dpx = px end
									if pos.Y then dpy = py end
									if pos.Z then dpz = pz end
									setVehicleComponentPosition(vehicle, name, dpx,dpy,dpz)
									setVehicleComponentVisible(vehicle, name, visible)
								end

							end

						end

					end
				end

			end
		end

	end
end, true, 'high')


addEventHandler('onClientResourceStart', resourceRoot, function()
	for model, data in pairs(models) do
		if type(data) ~= 'table' then
			models[model] = doors
		end
	end
end)